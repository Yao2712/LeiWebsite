<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Êº´ÁîªÈòÖËØª</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
      width: 100%;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Microsoft YaHei', 'Noto Sans SC', Arial, sans-serif;
      background: #f5f5f5;
      color: #000;
    }

    .viewer-container {
      display: flex;
      height: 100vh;
      flex-direction: row;
    }

    header.top-bar {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      z-index: 100;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: all 0.3s;
      pointer-events: auto;
    }

    header.top-bar.hidden {
      transform: translateY(-100%);
      pointer-events: none;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 15px;
      color: white;
      font-size: 18px;
      font-weight: 600;
    }

    .back-btn {
      background: none;
      border: none;
      color: white;
      font-size: 28px;
      cursor: pointer;
      padding: 0;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s;
    }

    .back-btn:hover {
      transform: scale(1.1);
    }

    .menu-btn {
      background: none;
      border: none;
      color: white;
      font-size: 28px;
      cursor: pointer;
      padding: 0;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s;
    }

    .menu-btn:hover {
      transform: scale(1.1);
    }

    .sidebar {
      width: 280px;
      background: white;
      border-left: 1px solid #e0e0e0;
      overflow-y: auto;
      padding: 80px 20px 20px;
      display: none;
      flex-direction: column;
      gap: 10px;
      position: absolute;
      right: 0;
      top: 0;
      bottom: 0;
      z-index: 90;
      box-shadow: -2px 0 8px rgba(0,0,0,0.1);
    }

    .sidebar.active {
      display: flex;
    }

    .sidebar h3 {
      font-size: 16px;
      font-weight: 600;
      margin-top: 10px;
      margin-bottom: 5px;
      color: #667eea;
    }

    .episode-link {
      padding: 12px 15px;
      border-radius: 6px;
      background: #f0f0f0;
      color: #333;
      text-decoration: none;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid transparent;
      font-size: 14px;
      display: block;
    }

    .episode-link:hover {
      background: #667eea;
      color: white;
      transform: translateX(4px);
    }

    .episode-link.active {
      background: #667eea;
      color: white;
      font-weight: 600;
      border-color: #667eea;
    }

    .content-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      margin-top: 60px;
      position: relative;
      transition: margin-top 0.3s ease;
      height: calc(100vh - 60px);
      overflow: hidden;
    }

    .content-area.ui-hidden {
      margin-top: 0;
    }

    .manga-pages {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      background: white;
      position: relative;
      padding: 0;
      transition: all 0.3s ease;
      height: calc(100vh - 140px);
    }

    .manga-pages.ui-hidden {
      padding: 0;
      background: black;
    }

    .manga-pages.single-page {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .manga-pages.scroll-mode {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      padding: 40px 20px;
      overflow-y: auto;
    }

    .scroll-mode .page-number-bg {
      position: relative;
      font-size: 80px;
      margin: 20px 0;
    }

    .mode-toggle {
      position: absolute;
      top: 70px;
      right: 20px;
      background: #667eea;
      border: none;
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      z-index: 50;
    }

    .mode-toggle:hover {
      background: #764ba2;
    }

    .page-number-bg {
      position: absolute;
      font-size: 200px;
      font-weight: 300;
      color: rgba(200, 200, 200, 0.3);
      user-select: none;
      pointer-events: none;
      line-height: 1;
    }

    .manga-image {
      max-width: 100%;
      max-height: calc(100vh - 140px);
      width: auto;
      height: auto;
      object-fit: contain;
      z-index: 10;
      cursor: pointer;
      display: block;
      margin: 0 auto;
    }

    .footer-nav {
      height: 80px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      gap: 20px;
      padding: 20px;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
      transition: all 0.3s;
      pointer-events: auto;
      flex-shrink: 0;
    }

    .footer-nav.hidden {
      height: 0;
      padding: 0;
      overflow: hidden;
      pointer-events: none;
    }

    .footer-left,
    .footer-center,
    .footer-right {
      display: flex;
      gap: 20px;
      align-items: center;
    }

    .footer-center {
      flex: 1;
      justify-content: center;
    }

    .nav-btn {
      background: transparent;
      border: none;
      color: white;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      min-width: 120px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .nav-btn:hover:not(:disabled) {
      background: rgba(255,255,255,0.2);
      border: 2px solid rgba(255,255,255,0.4);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .nav-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    #pageIndicator {
      color: white;
      font-weight: 600;
      font-size: 16px;
      min-width: 80px;
      text-align: center;
    }

    .hide-ui-btn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      z-index: 80;
      background: rgba(102, 126, 234, 0.8);
      border: none;
      color: white;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: auto;
    }

    .hide-ui-btn:hover {
      background: rgba(102, 126, 234, 1);
      transform: scale(1.1);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
    }

    .hide-ui-btn.hidden {
      background: rgba(255, 255, 255, 0.3);
      pointer-events: auto;
    }

    .sidebar-overlay {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 85;
      display: none;
    }

    .sidebar-overlay.active {
      display: block;
    }

    @media (max-width: 768px) {
      .viewer-container {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        max-height: 70vh;
        border-right: none;
        border-bottom: 1px solid #e0e0e0;
      }

      .footer-nav {
        flex-wrap: wrap;
        gap: 10px;
      }

      .nav-btn {
        flex: 1;
        min-width: auto;
      }

      .page-number-bg {
        font-size: 120px;
      }

      .manga-image {
        max-height: calc(100vh - 180px);
      }
    }

    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }

    ::-webkit-scrollbar-thumb {
      background: #667eea;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #764ba2;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
  <div class="viewer-container">
    <header class="top-bar">
      <div class="header-left">
        <button class="back-btn" id="backBtn" title="ËøîÂõû">‚Üê</button>
        <span id="currentEpisode">Á¨¨01ËØù</span>
      </div>
      <button class="menu-btn" id="menuBtn" title="ÁõÆÂΩï">‚ò∞</button>
    </header>

    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <button class="hide-ui-btn visible" id="hideUiBtn" title="ÂÖ®Â±èÈòÖËØª">¬´</button>

    <aside class="sidebar" id="sidebar">
      <h3>ÁõÆÂΩï</h3>
      <div id="episode-list"></div>
    </aside>

    <div class="content-area">
      <button class="mode-toggle" id="modeToggle">üìñ ÂçïÈ°µÊ®°Âºè</button>
      <div class="manga-pages single-page" id="mangaPages">
        <div class="page-number-bg" id="pageNumberBg">1</div>
        <img class="manga-image" id="mangaImage" src="" alt="Êº´ÁîªÈ°µÈù¢">
      </div>

      <div class="footer-nav">
        <div class="footer-left">
        </div>
        <div class="footer-center">
          <button class="nav-btn" id="prevBtn">‰∏ä‰∏ÄÈõÜ</button>
          <span id="pageIndicator">1 / 50</span>
          <button class="nav-btn" id="nextBtn">‰∏ã‰∏ÄÈõÜ</button>
        </div>
        <div class="footer-right"></div>
      </div>
    </div>
  </div>

  <script>
    // ========== ÈõÜÊï∞ÈÖçÁΩÆ ==========
    const episodes = [
      { id: 1, name: 'Á¨¨01ËØù', folder: '1.EP1', pages: 50 },
      { id: 2, name: 'Á¨¨02ËØù', folder: '1.EP2', pages: 25 },
      { id: 3, name: 'Á¨¨03ËØù', folder: '1.EP3', pages: 25 },
      { id: 4, name: 'Á¨¨04ËØù', folder: '1.EP4', pages: 21 },
      { id: 5, name: 'Á¨¨05ËØù', folder: '1.EP5', pages: 37 },
      { id: 5.5, name: 'Á¨¨5.5ËØù', folder: '1.SP01', pages: 16 },
      { id: 6, name: 'Á¨¨06ËØù', folder: '2.EP6', pages: 24 },
      { id: 7, name: 'Á¨¨07ËØù', folder: '2.EP7', pages: 32 },
      { id: 8, name: 'Á¨¨08ËØù', folder: '2.EP8', pages: 20 },
      { id: 9, name: 'Á¨¨09ËØù', folder: '2.EP9', pages: 43 },
      { id: 10, name: 'Á¨¨10ËØù', folder: '2.EP10', pages: 34 },
      { id: 10.5, name: 'Á¨¨10.5ËØù', folder: '2.SP02', pages: 9 },
      { id: 11, name: 'Á¨¨11ËØù', folder: '3.EP11', pages: 24 },
      { id: 12, name: 'Á¨¨12ËØù', folder: '3.EP12', pages: 34 },
      { id: 13, name: 'Á¨¨13ËØù', folder: '3.EP13', pages: 24 },
      { id: 14, name: 'Á¨¨14ËØù', folder: '3.EP14', pages: 42 },
      { id: 15, name: 'Á¨¨15ËØù', folder: '3.EP15', pages: 34 },
      { id: 15.5, name: 'Á¨¨15.5ËØù', folder: '3.SP03', pages: 15 },
      { id: 16, name: 'Á¨¨16ËØù', folder: '4.EP16', pages: 47 },
      { id: 17, name: 'Á¨¨17ËØù', folder: '4.EP17', pages: 16 },
      { id: 18, name: 'Á¨¨18ËØù', folder: '4.EP18', pages: 24 },
      { id: 19, name: 'Á¨¨19ËØù', folder: '4.EP19', pages: 33 },
      { id: 20, name: 'Á¨¨20ËØù', folder: '4.EP20', pages: 29 },
      { id: 20.5, name: 'Á¨¨20.5ËØù', folder: '4.SP04', pages: 13 },
      { id: 21, name: 'Á¨¨21ËØù', folder: '5.EP21', pages: 31 },
      { id: 22, name: 'Á¨¨22ËØù', folder: '5.EP22', pages: 22 },
      { id: 23, name: 'Á¨¨23ËØù', folder: '5.EP23', pages: 28 },
      { id: 24, name: 'Á¨¨24ËØù', folder: '5.EP24', pages: 24 },
      { id: 25, name: 'Á¨¨25ËØù', folder: '5.EP25', pages: 40 },
      { id: 25.5, name: 'Á¨¨25.5ËØù', folder: '5.SP05', pages: 11 },
      { id: 26, name: 'Á¨¨26ËØù', folder: '6.EP26', pages: 15 },
      { id: 27, name: 'Á¨¨27ËØù', folder: '6.EP27', pages: 25 },
      { id: 28, name: 'Á¨¨28ËØù', folder: '6.EP28', pages: 41 },
      { id: 29, name: 'Á¨¨29ËØù', folder: '6.EP29', pages: 33 },
      { id: 30, name: 'Á¨¨30ËØù', folder: '6.EP30', pages: 24 },
      { id: 31, name: 'Á¨¨31ËØù', folder: '6.EP31', pages: 41 },
      { id: 32, name: 'Á¨¨32ËØù', folder: '6.EP32', pages: 49 },
      { id: 32.5, name: 'Á¨¨32.5ËØù', folder: '6.SP06', pages: 26 },
      { id: 33, name: 'ÁâπÂà´ÁØá', folder: 'ÁâπÂà´ÁØá', pages: 21 },
      { id: 34, name: 'ËÅîÂä®01ËØù', folder: 'ËÅîÂä®01ËØù', pages: 8 }
    ];

    // ========== ZIP Âä†ËΩΩÂô® ==========
    const zipCache = {};

    async function loadZip(zipFileName) {
      if (zipCache[zipFileName]) return zipCache[zipFileName];
      
      try {
        const response = await fetch(`./${zipFileName}`);
        const data = await response.arrayBuffer();
        const zip = await JSZip.loadAsync(data);
        zipCache[zipFileName] = zip;
        console.log(`‚úÖ Âä†ËΩΩZIP: ${zipFileName}`);
        return zip;
      } catch (error) {
        console.error(`‚ùå Âä†ËΩΩZIPÂ§±Ë¥•: ${zipFileName}`, error);
        return null;
      }
    }

    async function getImageFromZip(zipFileName, imageName) {
      const zip = await loadZip(zipFileName);
      if (!zip) return null;
      
      const file = zip.file(imageName);
      if (!file) {
        console.error(`‚ùå ZIP‰∏≠Êâæ‰∏çÂà∞ÂõæÁâá: ${imageName}`);
        return null;
      }
      
      const blob = await file.async('blob');
      return URL.createObjectURL(blob);
    }

    async function getImageUrl(episode, pageNum) {
      const page = String(pageNum);
      let zipFileName, imageName;
      
      if (episode.folder.includes('.EP')) {
        const match = episode.folder.match(/(\d+)\.EP(\d+)/);
        if (match) {
          zipFileName = `${match[1]}.EP${match[2]}.zip`;
          imageName = `${episode.folder}/${match[2]}.${page}.jpg`;
        }
      } else if (episode.folder.includes('.SP')) {
        const match = episode.folder.match(/(\d+)\.SP(\d+)/);
        if (match) {
          zipFileName = `${match[1]}.SP${match[2]}.zip`;
          imageName = `${episode.folder}/SP${match[2]}.${page}.jpg`;
        }
      } else if (episode.folder === 'ÁâπÂà´ÁØá') {
        zipFileName = 'ÁâπÂà´ÁØá.zip';
        imageName = `ÁâπÂà´ÁØá/ÁâπÂà´ÁØá1.${page}.jpg`;
      } else if (episode.folder === 'ËÅîÂä®01ËØù') {
        zipFileName = 'ËÅîÂä®01ËØù.zip';
        imageName = `ËÅîÂä®01ËØù/ËÅîÂä®1.${page}.jpg`;
      }
      
      if (!zipFileName || !imageName) {
        console.error('Êó†Ê≥ïÁ°ÆÂÆöZIPÊàñÂõæÁâáÂêç', episode, pageNum);
        return null;
      }
      
      return await getImageFromZip(zipFileName, imageName);
    }

    // ========== ÂÖ®Â±ÄÂèòÈáè ==========
    let currentEpisodeIndex = 0;
    let currentPage = 1;
    let isScrollMode = false;
    let pageElements = [];
    let uiVisible = true;

    // ========== ÂàùÂßãÂåñ ==========
    document.addEventListener('DOMContentLoaded', function() {
      initializeEpisodeList();
      
      const params = new URLSearchParams(window.location.search);
      const epParam = params.get('ep');
      let startIndex = 0;
      
      if (epParam) {
        const epNum = parseFloat(epParam);
        const foundIndex = episodes.findIndex(ep => ep.id === epNum);
        if (foundIndex !== -1) {
          startIndex = foundIndex;
        }
      }
      
      loadEpisode(startIndex);
      setupEventListeners();
    });

    function initializeEpisodeList() {
      const episodeList = document.getElementById('episode-list');
      episodes.forEach((ep, index) => {
        const link = document.createElement('a');
        link.className = 'episode-link';
        if (index === 0) link.classList.add('active');
        link.textContent = ep.name;
        link.onclick = (e) => {
          e.preventDefault();
          loadEpisode(index);
          closeSidebar();
        };
        episodeList.appendChild(link);
      });
    }

    async function loadEpisode(index) {
      currentEpisodeIndex = index;
      currentPage = 1;
      const episode = episodes[index];
      
      document.getElementById('currentEpisode').textContent = episode.name;

      document.querySelectorAll('.episode-link').forEach((link, i) => {
        link.classList.toggle('active', i === index);
      });

      if (isScrollMode) {
        await loadScrollMode();
      } else {
        await loadPage(1);
      }

      updatePageNavButtons();
    }

    async function loadPage(pageNum) {
      if (pageNum < 1 || pageNum > episodes[currentEpisodeIndex].pages) return;
      
      currentPage = pageNum;
      const episode = episodes[currentEpisodeIndex];
      
      const imageUrl = await getImageUrl(episode, pageNum);
      
      if (imageUrl) {
        document.getElementById('mangaImage').src = imageUrl;
        document.getElementById('pageNumberBg').textContent = pageNum;
        document.getElementById('pageIndicator').textContent = `${pageNum} / ${episode.pages}`;
        updatePageButtons();
        
        // Âº∫Âà∂ÊªöÂä®Âà∞È°∂ÈÉ®ÔºåÈÅøÂÖçÂõæÁâáË¢´UIÊå°‰Ωè
        document.getElementById('mangaPages').scrollTop = 0;
      }
    }

    async function loadScrollMode() {
      const mangaPages = document.getElementById('mangaPages');
      const episode = episodes[currentEpisodeIndex];
      mangaPages.innerHTML = '';
      pageElements = [];

      for (let i = 1; i <= episode.pages; i++) {
        const pageContainer = document.createElement('div');
        pageContainer.style.position = 'relative';
        pageContainer.style.marginBottom = '20px';
        pageContainer.setAttribute('data-page', i);

        const pageNum = document.createElement('div');
        pageNum.className = 'page-number-bg';
        pageNum.textContent = i;

        const img = document.createElement('img');
        img.className = 'manga-image';
        
        const imageUrl = await getImageUrl(episode, i);
        if (imageUrl) img.src = imageUrl;
        
        img.alt = `È°µÈù¢ ${i}`;

        pageContainer.appendChild(pageNum);
        pageContainer.appendChild(img);
        mangaPages.appendChild(pageContainer);
        pageElements.push(pageContainer);
      }

      setupScrollTracking();
      updatePageIndicator();
    }

    function nextPage() {
      const episode = episodes[currentEpisodeIndex];
      if (currentPage < episode.pages) {
        loadPage(currentPage + 1);
      }
    }

    function prevPage() {
      if (currentPage > 1) {
        loadPage(currentPage - 1);
      }
    }

    function updatePageButtons() {
      const episode = episodes[currentEpisodeIndex];
      document.getElementById('prevBtn').disabled = currentEpisodeIndex === 0;
      document.getElementById('nextBtn').disabled = currentEpisodeIndex === episodes.length - 1;
      document.getElementById('pageIndicator').textContent = `${currentPage} / ${episode.pages}`;
    }

    function setupEventListeners() {
      document.getElementById('backBtn').addEventListener('click', () => {
        window.location.href = './‰∏é‰Ω†ÁºñÁºÄÁöÑÊ≥°Ê≤´.html';
      });

      document.getElementById('menuBtn').addEventListener('click', toggleSidebar);
      document.getElementById('sidebarOverlay').addEventListener('click', closeSidebar);
      document.getElementById('modeToggle').addEventListener('click', toggleReadMode);
      
      // ‰∏ä‰∏ÄÈõÜ/‰∏ã‰∏ÄÈõÜÊåâÈíÆ - ÂàáÊç¢Á´†ËäÇ
      document.getElementById('prevBtn').addEventListener('click', () => {
        if (currentEpisodeIndex > 0) {
          loadEpisode(currentEpisodeIndex - 1);
        }
      });

      document.getElementById('nextBtn').addEventListener('click', () => {
        if (currentEpisodeIndex < episodes.length - 1) {
          loadEpisode(currentEpisodeIndex + 1);
        }
      });

      document.getElementById('hideUiBtn').addEventListener('click', toggleUIVisibility);

      // ÈîÆÁõòÁøªÈ°µ - Âêå‰∏ÄÁ´†ÂÜÖÁøªÈ°µ
      document.addEventListener('keydown', (e) => {
        if (document.getElementById('sidebar').classList.contains('active')) return;
        if (!isScrollMode) {
          if (e.key === 'ArrowRight' || e.key === ' ') {
            nextPage();
            e.preventDefault();
          } else if (e.key === 'ArrowLeft') {
            prevPage();
            e.preventDefault();
          }
        }
      });

      // Èº†Ê†áÊªöËΩÆÁøªÈ°µ - Âêå‰∏ÄÁ´†ÂÜÖÁøªÈ°µ
      let wheelTimer = null;
      document.getElementById('mangaPages').addEventListener('wheel', (e) => {
        if (!isScrollMode) {
          e.preventDefault();
          
          if (wheelTimer) return;
          
          wheelTimer = setTimeout(() => {
            if (e.deltaY > 0) {
              nextPage();
            } else {
              prevPage();
            }
            wheelTimer = null;
          }, 50);
        }
      }, { passive: false });

      // ÁÇπÂáªÂõæÁâáÁøªÈ°µ - Âêå‰∏ÄÁ´†ÂÜÖÁøªÈ°µ
      document.getElementById('mangaImage').addEventListener('click', (e) => {
        if (!isScrollMode) {
          const clickX = e.clientX;
          const windowWidth = window.innerWidth;
          
          if (clickX > windowWidth * 0.7) {
            nextPage();
          } else if (clickX < windowWidth * 0.3) {
            prevPage();
          }
        }
      });
    }

    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebarOverlay');
      sidebar.classList.toggle('active');
      overlay.classList.toggle('active');
    }

    function closeSidebar() {
      document.getElementById('sidebar').classList.remove('active');
      document.getElementById('sidebarOverlay').classList.remove('active');
    }

    async function toggleReadMode() {
      isScrollMode = !isScrollMode;
      const mangaPages = document.getElementById('mangaPages');
      const modeToggle = document.getElementById('modeToggle');
      
      if (isScrollMode) {
        mangaPages.classList.remove('single-page');
        mangaPages.classList.add('scroll-mode');
        modeToggle.textContent = 'üìÑ ÊªöÂä®Ê®°Âºè';
        await loadScrollMode();
      } else {
        mangaPages.classList.remove('scroll-mode');
        mangaPages.classList.add('single-page');
        modeToggle.textContent = 'üìñ ÂçïÈ°µÊ®°Âºè';
        mangaPages.innerHTML = `
          <div class="page-number-bg" id="pageNumberBg">${currentPage}</div>
          <img class="manga-image" id="mangaImage" src="" alt="Êº´ÁîªÈ°µÈù¢">
        `;
        await loadPage(currentPage);
      }
    }

    function setupScrollTracking() {
      document.getElementById('mangaPages').addEventListener('scroll', updatePageIndicator);
    }

    function updatePageIndicator() {
      if (!isScrollMode) return;
      const mangaPages = document.getElementById('mangaPages');
      const episode = episodes[currentEpisodeIndex];
      for (let i = 0; i < pageElements.length; i++) {
        const rect = pageElements[i].getBoundingClientRect();
        if (rect.top <= mangaPages.clientHeight / 2 && rect.bottom >= mangaPages.clientHeight / 2) {
          currentPage = i + 1;
          break;
        }
      }
      document.getElementById('pageIndicator').textContent = `${currentPage} / ${episode.pages}`;
    }

    function toggleUIVisibility() {
      uiVisible = !uiVisible;
      const header = document.querySelector('header.top-bar');
      const footer = document.querySelector('.footer-nav');
      const mangaPages = document.getElementById('mangaPages');
      const hideBtn = document.getElementById('hideUiBtn');
      
      if (uiVisible) {
        header.classList.remove('hidden');
        footer.classList.remove('hidden');
        hideBtn.classList.remove('hidden');
        mangaPages.style.height = 'calc(100vh - 140px)';
        hideBtn.textContent = '¬´';
        hideBtn.title = 'ÈöêËóèÁïåÈù¢';
      } else {
        header.classList.add('hidden');
        footer.classList.add('hidden');
        hideBtn.classList.add('hidden');
        mangaPages.style.height = '100vh';
        hideBtn.textContent = '¬ª';
        hideBtn.title = 'ÊòæÁ§∫ÁïåÈù¢';
      }
    }
  </script>
</body>
</html>
